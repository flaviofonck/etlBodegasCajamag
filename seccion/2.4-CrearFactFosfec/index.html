
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../2.3-FactSubsidioVivienda/">
      
      
        <link rel="next" href="../2.4-CrearFactFosfecold/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.41">
    
    
      
        <title>2.4-CrearFactFosfec - Documentación del Proyecto ETL - Completo</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#24-crearfactfosfec" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Documentación del Proyecto ETL - Completo" class="md-header__button md-logo" aria-label="Documentación del Proyecto ETL - Completo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentación del Proyecto ETL - Completo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2.4-CrearFactFosfec
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Documentación del Proyecto ETL - Completo" class="md-nav__button md-logo" aria-label="Documentación del Proyecto ETL - Completo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Documentación del Proyecto ETL - Completo
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instalacion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instalación y Configuración
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../codigo/funciones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Funciones.py
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bodegas
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Bodegas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bodega 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Bodega 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../IntroBodega1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.2-EstandarAfiliados2.0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2-EstandarAfiliados2.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.4-Dimensiones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.4-Dimensiones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.3-CalendarioMensual/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3-CalendarioMensual
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.6-FactDatosContacto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.6-FactDatosContacto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.5-FactAfiliacion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.5-FactAfiliacion
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bodega 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Bodega 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../IntroBodega2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.1-FactAportes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1-FactAportes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.2-FactEntrega/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2-FactEntrega
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.3-FactSubsidioVivienda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.3-FactSubsidioVivienda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    2.4-CrearFactFosfec
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2.4-CrearFactFosfec
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#importacion-de-bibliotecas-y-configuracion-inicial" class="md-nav__link">
    <span class="md-ellipsis">
      Importación de bibliotecas y configuración inicial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#definicion-de-consultas-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Definición de consultas SQL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conexion-y-carga-de-tablas-desde-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Conexión y carga de tablas desde SQL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#definicion-de-funciones-de-transformacion-y-limpieza" class="md-nav__link">
    <span class="md-ellipsis">
      Definición de funciones de transformación y limpieza
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proceso-de-limpieza-y-validacion-de-duplicados" class="md-nav__link">
    <span class="md-ellipsis">
      Proceso de limpieza y validación de duplicados
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guardar-en-la-base-de-datos-dwh" class="md-nav__link">
    <span class="md-ellipsis">
      Guardar en la base de datos DWH
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.4-CrearFactFosfecold/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.4-CrearFactFosfecold
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bodega 3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Bodega 3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../IntroBodega3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3.1-FactTransaccionesVentas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.1-FactTransaccionesVentas
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bodega 4
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Bodega 4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../IntroBodega4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4.1-FactColegio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.1-FactColegio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4.1-FactColegio_fijos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.1-FactColegio_fijos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bodega 5
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Bodega 5
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../IntroBodega5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5.1-FactServicioSocial%20copy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.1-FactServicioSocial copy
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bodega 6
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Bodega 6
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../IntroBodega6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6.1-main_encuestasV1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.1-main_encuestasV1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#importacion-de-bibliotecas-y-configuracion-inicial" class="md-nav__link">
    <span class="md-ellipsis">
      Importación de bibliotecas y configuración inicial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#definicion-de-consultas-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Definición de consultas SQL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conexion-y-carga-de-tablas-desde-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Conexión y carga de tablas desde SQL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#definicion-de-funciones-de-transformacion-y-limpieza" class="md-nav__link">
    <span class="md-ellipsis">
      Definición de funciones de transformación y limpieza
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proceso-de-limpieza-y-validacion-de-duplicados" class="md-nav__link">
    <span class="md-ellipsis">
      Proceso de limpieza y validación de duplicados
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guardar-en-la-base-de-datos-dwh" class="md-nav__link">
    <span class="md-ellipsis">
      Guardar en la base de datos DWH
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="24-crearfactfosfec">2.4-CrearFactFosfec<a class="headerlink" href="#24-crearfactfosfec" title="Permanent link">&para;</a></h1>
<h3 id="importacion-de-bibliotecas-y-configuracion-inicial">Importación de bibliotecas y configuración inicial<a class="headerlink" href="#importacion-de-bibliotecas-y-configuracion-inicial" title="Permanent link">&para;</a></h3>
<p>Se importan las bibliotecas necesarias, como <code>sqlalchemy</code>, <code>pandas</code>, <code>pymysql</code>, y <code>dateutil</code>. Además, se importa un módulo de funciones personalizadas desde un archivo externo <code>Funciones.py</code>, incluyendo funciones como <code>StoreDuplicated</code>, <code>RemoveDuplicated</code>, <code>RemoveErrors</code>, <code>Conexion_Minerva</code>, y <code>Conexion_dwh</code>. También se configura el logger para registrar eventos en un archivo <code>FactFosFec.log</code>, y se inicia el proceso ETL, registrando el evento de inicio en el log.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Importar bibliotecas necesarias</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>


<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="c1">#---------------------------------------------</span>

<span class="c1">#Import de modulo funciones</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Agrega el directorio al sys.path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../funciones&#39;</span><span class="p">))</span>
<span class="c1"># Importa las funciones desde el archivo Funciones.py</span>
<span class="kn">from</span> <span class="nn">Funciones</span> <span class="kn">import</span> <span class="n">guardar_en_dwh</span><span class="p">,</span> <span class="n">StoreDuplicated</span><span class="p">,</span> <span class="n">RemoveDuplicated</span><span class="p">,</span> <span class="n">RemoveErrors</span><span class="p">,</span> <span class="n">cargar_tablas</span><span class="p">,</span> <span class="n">obtener_conexion</span><span class="p">,</span> <span class="n">testfunciones</span><span class="p">,</span> <span class="n">setup_logger</span>
<span class="nb">print</span><span class="p">(</span><span class="n">testfunciones</span><span class="p">())</span>

<span class="c1"># Configuración inicial</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="n">log_filename</span><span class="o">=</span><span class="s1">&#39;FactFosFec.log&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;COMIENZO ETL&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-13 12:15:50,105 - INFO - COMIENZO ETL


Importacion de funciones correcta, 13-10-2024 12:15
</code></pre></div>

<h3 id="definicion-de-consultas-sql">Definición de consultas SQL<a class="headerlink" href="#definicion-de-consultas-sql" title="Permanent link">&para;</a></h3>
<p>Se define una consulta SQL en el diccionario <code>qr_structure</code> que extrae datos de las tablas <code>fosfec160</code>, <code>fosfec07</code>, <code>fosfec09</code>, y <code>fosfec21</code> de la base de datos <code>fosfec</code>, utilizando varias combinaciones de <code>INNER JOIN</code> y <code>LEFT JOIN</code>. La consulta selecciona columnas clave relacionadas con fechas, documentos y salarios. El proceso de lectura de consultas se registra en el log.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Consultas SQL</span>

<span class="n">qr_structure</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;fact_foscec&quot;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    SELECT </span>
<span class="s1">        fosfec160.id,</span>
<span class="s1">        fosfec160.cedtra,</span>
<span class="s1">        fosfec160.tipdoc,</span>
<span class="s1">        fosfec160.fecexp,</span>
<span class="s1">        fosfec160.fecsis,</span>
<span class="s1">        fosfec07.fecasi,</span>
<span class="s1">        fosfec07.fecest,</span>
<span class="s1">        fosfec09.fecnac,</span>
<span class="s1">        fosfec160.fecfin,</span>
<span class="s1">        fosfec09.fecdig,</span>
<span class="s1">        fosfec09.fecsal,</span>
<span class="s1">        fosfec160.fecenv,</span>
<span class="s1">        fosfec160.fecterm,</span>
<span class="s1">        fosfec160.salario,</span>
<span class="s1">        fosfec09.ultsal,</span>
<span class="s1">        fosfec160.bonopen,</span>
<span class="s1">        fosfec07.recsub,</span>
<span class="s1">        fosfec07.cuosub,</span>
<span class="s1">        fosfec160.numdaviplata,</span>
<span class="s1">        fosfec07.documento,</span>
<span class="s1">        fosfec160.numres,</span>
<span class="s1">        fosfec160.codcat,</span>
<span class="s1">        fosfec160.codpen,</span>
<span class="s1">        fosfec07.codces,</span>
<span class="s1">        fosfec160.codcaj</span>
<span class="s1">    FROM fosfec.fosfec160 </span>
<span class="s1">    INNER JOIN fosfec.fosfec07 </span>
<span class="s1">        ON CONVERT(fosfec.fosfec160.cedtra USING utf8) COLLATE utf8_unicode_ci = CONVERT(fosfec.fosfec07.cedtra USING utf8) COLLATE utf8_unicode_ci </span>
<span class="s1">    INNER JOIN fosfec.fosfec09 </span>
<span class="s1">        ON fosfec.fosfec07.cedtra = fosfec.fosfec09.cedtra </span>
<span class="s1">    LEFT JOIN fosfec.fosfec21 </span>
<span class="s1">        ON CONVERT(fosfec.fosfec21.cedcon USING utf8) COLLATE utf8_unicode_ci = fosfec.fosfec160.cedtra</span>
<span class="s1">    &#39;&#39;&#39;</span>
<span class="p">}</span>


<span class="n">df_structure</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;LECTURA DE QUERYS&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-13 12:15:50,127 - INFO - LECTURA DE QUERYS
</code></pre></div>

<h3 id="conexion-y-carga-de-tablas-desde-sql">Conexión y carga de tablas desde SQL<a class="headerlink" href="#conexion-y-carga-de-tablas-desde-sql" title="Permanent link">&para;</a></h3>
<p>Este código se conecta a la base de datos Minerva y carga las tablas especificadas en <code>qr_structure</code> utilizando SQL. Para cada tabla, el proceso de carga es registrado en el <code>logger</code>, y al final se registra el tiempo total que tomó cargar todas las tablas desde MySQL. Esto permite monitorear la ejecución y duración del proceso de carga de datos.</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Conexion a base Minerva</span>
<span class="n">motor</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">obtener_conexion</span><span class="p">(</span><span class="s1">&#39;minerva&#39;</span><span class="p">))</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CONEXION A BASE MINERVA&#39;</span><span class="p">)</span>
<span class="n">cargar_tablas</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="n">qr_structure</span><span class="p">,</span> <span class="n">df_structure</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-13 12:15:50,282 - INFO - CONEXION A BASE MINERVA
2024-10-13 12:15:50,815 - INFO - Cargando fact_foscec 
2024-10-13 12:20:07,867 - INFO - Cargada fact_foscec --- 257.05 seconds ---
2024-10-13 12:20:07,954 - INFO - CARGUE TABLAS DESDE MYSQL --- 257.67 seconds ---
</code></pre></div>

<h3 id="definicion-de-funciones-de-transformacion-y-limpieza">Definición de funciones de transformación y limpieza<a class="headerlink" href="#definicion-de-funciones-de-transformacion-y-limpieza" title="Permanent link">&para;</a></h3>
<p>Se define el identificador único <code>columId</code> como <code>'id'</code>, y se crea una lista llamada <code>ColumnsToCompare</code> que contiene las columnas clave del dataframe que se utilizarán en los procesos de transformación y limpieza. Estas columnas incluyen datos sobre fechas, salarios, documentos, y códigos. Esta lista es esencial para las operaciones posteriores, como la identificación de duplicados y la validación de datos.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Definición de funciones de transformación y limpieza</span>
<span class="n">columId</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span>  <span class="c1"># Ajusta según tu identificador único</span>

<span class="c1"># Lista actualizada de columnas que cumplen con las restricciones</span>
<span class="n">ColumnsToCompare</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;cedtra&#39;</span><span class="p">,</span> <span class="s1">&#39;tipdoc&#39;</span><span class="p">,</span> <span class="s1">&#39;fecexp&#39;</span><span class="p">,</span> <span class="s1">&#39;fecsis&#39;</span><span class="p">,</span> <span class="s1">&#39;fecasi&#39;</span><span class="p">,</span> <span class="s1">&#39;fecest&#39;</span><span class="p">,</span> <span class="s1">&#39;fecnac&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;fecfin&#39;</span><span class="p">,</span> <span class="s1">&#39;fecdig&#39;</span><span class="p">,</span> <span class="s1">&#39;fecsal&#39;</span><span class="p">,</span> <span class="s1">&#39;fecenv&#39;</span><span class="p">,</span> <span class="s1">&#39;fecterm&#39;</span><span class="p">,</span> <span class="s1">&#39;salario&#39;</span><span class="p">,</span> <span class="s1">&#39;ultsal&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;bonopen&#39;</span><span class="p">,</span> <span class="s1">&#39;recsub&#39;</span><span class="p">,</span> <span class="s1">&#39;cuosub&#39;</span><span class="p">,</span> <span class="s1">&#39;numdaviplata&#39;</span><span class="p">,</span> <span class="s1">&#39;documento&#39;</span><span class="p">,</span> <span class="s1">&#39;numres&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;codcat&#39;</span><span class="p">,</span> <span class="s1">&#39;codpen&#39;</span><span class="p">,</span> <span class="s1">&#39;codces&#39;</span><span class="p">,</span> <span class="s1">&#39;codcaj&#39;</span>
<span class="p">]</span>
</code></pre></div>
<h3 id="proceso-de-limpieza-y-validacion-de-duplicados">Proceso de limpieza y validación de duplicados<a class="headerlink" href="#proceso-de-limpieza-y-validacion-de-duplicados" title="Permanent link">&para;</a></h3>
<p>Se itera sobre los dataframes en <code>df_structure</code>, guardando los duplicados mediante la función <code>StoreDuplicated</code> usando las columnas especificadas en <code>ColumnsToCompare</code>. Si la columna <code>f_disp_benef</code> está presente, se eliminan duplicados en función de esa fecha; en caso contrario, se omite esa operación y se registra una advertencia en el log. Posteriormente, se limpia el dataframe de errores utilizando la función <code>RemoveErrors</code>. Cada tabla procesada se registra en el log al completar la validación y limpieza de duplicados. </p>
<div class="highlight"><pre><span></span><code><span class="c1"># Iterar sobre los DataFrames para realizar transformaciones</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_structure</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Procesando tabla: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Guardar duplicados</span>
    <span class="n">StoreDuplicated</span><span class="p">(</span><span class="s1">&#39;N/A&#39;</span><span class="p">,</span> <span class="n">ColumnsToCompare</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="s1">&#39;duplicados_fact_fosfec_&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>

    <span class="c1"># Eliminar duplicados por fecha (asegúrate de tener una columna de fecha adecuada en tu DataFrame)</span>
    <span class="k">if</span> <span class="s1">&#39;f_disp_benef&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df_cleaned</span> <span class="o">=</span> <span class="n">RemoveDuplicated</span><span class="p">(</span><span class="n">columId</span><span class="p">,</span> <span class="s1">&#39;f_disp_benef&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Columna de fecha &quot;f_disp_benef&quot; no encontrada en </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">. Se omite la eliminación de duplicados por fecha.&#39;</span><span class="p">)</span>
        <span class="n">df_cleaned</span> <span class="o">=</span> <span class="n">df</span>

    <span class="c1"># Limpiar errores (si fuera aplicable a tu contexto)</span>
    <span class="n">df_final</span> <span class="o">=</span> <span class="n">RemoveErrors</span><span class="p">(</span><span class="n">df_cleaned</span><span class="p">,</span> <span class="s1">&#39;errores_fact_foscec_&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Proceso de limpieza y validación de duplicados completado para la tabla: &#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-13 12:20:08,077 - WARNING - Columna de fecha &quot;f_disp_benef&quot; no encontrada en fact_foscec. Se omite la eliminación de duplicados por fecha.
2024-10-13 12:20:08,079 - INFO - Proceso de limpieza y validación de duplicados completado para la tabla: fact_foscec


Procesando tabla: fact_foscec
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">df_structure</span><span class="p">[</span><span class="s1">&#39;fact_foscec&#39;</span><span class="p">]</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>cedtra</th>
      <th>tipdoc</th>
      <th>fecexp</th>
      <th>fecsis</th>
      <th>fecasi</th>
      <th>fecest</th>
      <th>fecnac</th>
      <th>fecfin</th>
      <th>fecdig</th>
      <th>...</th>
      <th>bonopen</th>
      <th>recsub</th>
      <th>cuosub</th>
      <th>numdaviplata</th>
      <th>documento</th>
      <th>numres</th>
      <th>codcat</th>
      <th>codpen</th>
      <th>codces</th>
      <th>codcaj</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>31914</td>
      <td>1004271963</td>
      <td>CC</td>
      <td>2012-11-21</td>
      <td>2024-04-09</td>
      <td>2024-05-16</td>
      <td>2024-04-10</td>
      <td>1994-01-09</td>
      <td>None</td>
      <td>2024-04-09</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>2</td>
      <td>3005770663</td>
      <td>0023812</td>
      <td>1</td>
      <td>B</td>
      <td>230201</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>25102</td>
      <td>1004344943</td>
      <td>CC</td>
      <td>2005-10-24</td>
      <td>2022-12-03</td>
      <td>None</td>
      <td>2022-12-16</td>
      <td>1989-06-04</td>
      <td>None</td>
      <td>2023-01-05</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>1</td>
      <td>3014970292</td>
      <td>0017310</td>
      <td>1</td>
      <td>A</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>25102</td>
      <td>1004344943</td>
      <td>CC</td>
      <td>2005-10-24</td>
      <td>2022-12-03</td>
      <td>2023-02-15</td>
      <td>2023-01-11</td>
      <td>1989-06-04</td>
      <td>None</td>
      <td>2023-01-05</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>1</td>
      <td>3014970292</td>
      <td>0017493</td>
      <td>1</td>
      <td>A</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>25285</td>
      <td>1004344943</td>
      <td>CC</td>
      <td>2005-10-24</td>
      <td>2023-01-05</td>
      <td>None</td>
      <td>2022-12-16</td>
      <td>1989-06-04</td>
      <td>None</td>
      <td>2023-01-05</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>1</td>
      <td>3014970292</td>
      <td>0017310</td>
      <td>1</td>
      <td>A</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>25285</td>
      <td>1004344943</td>
      <td>CC</td>
      <td>2005-10-24</td>
      <td>2023-01-05</td>
      <td>2023-02-15</td>
      <td>2023-01-11</td>
      <td>1989-06-04</td>
      <td>None</td>
      <td>2023-01-05</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>1</td>
      <td>3014970292</td>
      <td>0017493</td>
      <td>1</td>
      <td>A</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>17118</th>
      <td>34281</td>
      <td>19604571</td>
      <td>CC</td>
      <td>2004-03-01</td>
      <td>2024-10-04</td>
      <td>None</td>
      <td>2022-10-10</td>
      <td>1985-01-25</td>
      <td>None</td>
      <td>2022-09-10</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>4</td>
      <td>3128019398</td>
      <td>0016479</td>
      <td>1</td>
      <td>None</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>17119</th>
      <td>34285</td>
      <td>1082968559</td>
      <td>CC</td>
      <td>2011-06-21</td>
      <td>2024-10-08</td>
      <td>None</td>
      <td>2024-09-17</td>
      <td>1993-04-03</td>
      <td>None</td>
      <td>2024-09-10</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>2</td>
      <td>3242483705</td>
      <td>0025692</td>
      <td>1</td>
      <td>None</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>17120</th>
      <td>34287</td>
      <td>1081786023</td>
      <td>CC</td>
      <td>2004-07-09</td>
      <td>2024-10-08</td>
      <td>2017-04-20</td>
      <td>2020-02-06</td>
      <td>1986-05-18</td>
      <td>None</td>
      <td>2018-06-13</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>2</td>
      <td>3113203794</td>
      <td>0005686</td>
      <td>1</td>
      <td>None</td>
      <td>230301</td>
      <td>SINAFP</td>
      <td>None</td>
    </tr>
    <tr>
      <th>17121</th>
      <td>34293</td>
      <td>1082841439</td>
      <td>CC</td>
      <td>2004-07-09</td>
      <td>2024-10-10</td>
      <td>None</td>
      <td>2023-10-03</td>
      <td>1983-02-21</td>
      <td>None</td>
      <td>2024-02-01</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>1</td>
      <td>3187737349</td>
      <td>0020743</td>
      <td>1</td>
      <td>None</td>
      <td>231001</td>
      <td>None</td>
      <td>07</td>
    </tr>
    <tr>
      <th>17122</th>
      <td>34293</td>
      <td>1082841439</td>
      <td>CC</td>
      <td>2004-07-09</td>
      <td>2024-10-10</td>
      <td>None</td>
      <td>2024-03-11</td>
      <td>1983-02-21</td>
      <td>None</td>
      <td>2024-02-01</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>1</td>
      <td>3187737349</td>
      <td>0022497</td>
      <td>1</td>
      <td>None</td>
      <td>231001</td>
      <td>None</td>
      <td>07</td>
    </tr>
  </tbody>
</table>
<p>17123 rows × 25 columns</p>
</div>

<h3 id="guardar-en-la-base-de-datos-dwh">Guardar en la base de datos DWH<a class="headerlink" href="#guardar-en-la-base-de-datos-dwh" title="Permanent link">&para;</a></h3>
<p>Se guarda el dataframe <code>fact_foscec</code> en la tabla <code>BD_FactFosfec</code> de la base de datos DWH. Si la tabla ya existe, se reemplaza con los nuevos datos. El tiempo total de almacenamiento se registra en el log, seguido del registro de finalización del proceso ETL, incluyendo el tiempo total desde el inicio del proceso.</p>
<div class="highlight"><pre><span></span><code><span class="n">guardar_en_dwh</span><span class="p">(</span><span class="n">df_structure</span><span class="p">[</span><span class="s1">&#39;fact_foscec&#39;</span><span class="p">],</span> <span class="s1">&#39;BD_FactFosfec&#39;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-13 12:21:05,422 - INFO - CONEXION A BASE DWH
2024-10-13 12:21:05,934 - INFO - Almacenando tabla única en DWH como BD_FactFosfec
2024-10-13 12:21:11,117 - INFO - Tabla almacenada correctamente.
2024-10-13 12:21:11,227 - INFO - ALMACENAMIENTO --- 5.80 seconds ---
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Tiempo total de ejecución</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FINAL ETL --- </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds ---&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-12 23:45:03,410 - INFO - FINAL ETL --- 243.36 seconds ---
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># </span>
<span class="n">tabla</span> <span class="o">=</span> <span class="n">df_structure</span><span class="p">[</span><span class="s1">&#39;fact_foscec&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Numero de registros </span><span class="si">{</span><span class="n">tabla</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">tabla</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Agrupamos por documento y periodo, aplicando funciones de agregación que tengan sentido</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">tabla</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;fecasi&#39;</span><span class="p">,</span> <span class="s1">&#39;documento&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s1">&#39;cedtra&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;tipdoc&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;fecest&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;salario&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;ultsal&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;bonopen&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;recsub&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;cuosub&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span>   
    <span class="s1">&#39;numdaviplata&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;codcat&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;codpen&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span>  
<span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Comparar el número de registros antes y después</span>
<span class="n">original_count</span> <span class="o">=</span> <span class="n">tabla</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">grouped_count</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">original_count</span><span class="p">,</span> <span class="n">grouped_count</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Numero de registros 17123





(17123, 9460)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">df_grouped</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fecasi</th>
      <th>documento</th>
      <th>cedtra</th>
      <th>tipdoc</th>
      <th>fecest</th>
      <th>salario</th>
      <th>ultsal</th>
      <th>bonopen</th>
      <th>recsub</th>
      <th>cuosub</th>
      <th>numdaviplata</th>
      <th>codcat</th>
      <th>codpen</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2014-07-24</td>
      <td>0000002</td>
      <td>85473356</td>
      <td>CC</td>
      <td>None</td>
      <td>1.560.000</td>
      <td>737717</td>
      <td>None</td>
      <td>S</td>
      <td>2</td>
      <td>NO TENGO</td>
      <td>A</td>
      <td>230301</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2014-07-24</td>
      <td>0000003</td>
      <td>39032364</td>
      <td>CC</td>
      <td>None</td>
      <td>720.000</td>
      <td>781242</td>
      <td>None</td>
      <td>N</td>
      <td>0</td>
      <td>3152117593</td>
      <td>A</td>
      <td>25-14</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2014-07-24</td>
      <td>0000021</td>
      <td>85473678</td>
      <td>CC</td>
      <td>None</td>
      <td>877803</td>
      <td>1129093</td>
      <td>None</td>
      <td>S</td>
      <td>1</td>
      <td>3013570721</td>
      <td>A</td>
      <td>231001</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2014-07-24</td>
      <td>0000024</td>
      <td>39046011</td>
      <td>CC</td>
      <td>None</td>
      <td>3328000</td>
      <td>1284000</td>
      <td>None</td>
      <td>N</td>
      <td>0</td>
      <td>3175011658</td>
      <td>B</td>
      <td>230301</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2014-07-24</td>
      <td>0000030</td>
      <td>7629151</td>
      <td>CC</td>
      <td>None</td>
      <td>1300000</td>
      <td>1300000</td>
      <td>N</td>
      <td>N</td>
      <td>0</td>
      <td>3103527803</td>
      <td>A</td>
      <td>230201</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9455</th>
      <td>2024-09-18</td>
      <td>0025288</td>
      <td>1004272164</td>
      <td>CC</td>
      <td>2024-08-26</td>
      <td>13000000</td>
      <td>1300000</td>
      <td>N</td>
      <td>N</td>
      <td>0</td>
      <td>3243202882</td>
      <td>A</td>
      <td>230301</td>
    </tr>
    <tr>
      <th>9456</th>
      <td>2024-09-18</td>
      <td>0025289</td>
      <td>57467186</td>
      <td>CC</td>
      <td>2024-09-25</td>
      <td>1950000</td>
      <td>3300000</td>
      <td>N</td>
      <td>S</td>
      <td>1</td>
      <td>3182112369</td>
      <td>B</td>
      <td>230201</td>
    </tr>
    <tr>
      <th>9457</th>
      <td>2024-09-18</td>
      <td>0025290</td>
      <td>1128105347</td>
      <td>CC</td>
      <td>2024-08-27</td>
      <td>1300000</td>
      <td>1300000</td>
      <td>N</td>
      <td>S</td>
      <td>2</td>
      <td>3145862495</td>
      <td>A</td>
      <td>231001</td>
    </tr>
    <tr>
      <th>9458</th>
      <td>2024-09-18</td>
      <td>0025294</td>
      <td>36667152</td>
      <td>CC</td>
      <td>None</td>
      <td>1300000</td>
      <td>1300000</td>
      <td>N</td>
      <td>N</td>
      <td>0</td>
      <td>3238985219</td>
      <td>A</td>
      <td>25-14</td>
    </tr>
    <tr>
      <th>9459</th>
      <td>2024-09-18</td>
      <td>0025295</td>
      <td>1082977918</td>
      <td>CC</td>
      <td>None</td>
      <td>1442158</td>
      <td>1442158</td>
      <td>N</td>
      <td>N</td>
      <td>0</td>
      <td>3008801927</td>
      <td>A</td>
      <td>230201</td>
    </tr>
  </tbody>
</table>
<p>9460 rows × 13 columns</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../js/init_mermaid.js"></script>
      
    
  </body>
</html>